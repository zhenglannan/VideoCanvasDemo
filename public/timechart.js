class TimeChart{constructor(t){this._canvas=t,this._canvas.addEventListener("click",t=>{this.processEvent(t,this._timeClick)}),this._canvas.addEventListener("mousemove",t=>{this.processEvent(t,this._timeMove)}),this._ctx=this._canvas.getContext("2d"),this._periodColor="#4763E8",this._lineColor="#FFFF00",this._periods=new Array,this.paint()}set ontimeclick(t){this._timeClick=t}set ontimemove(t){this._timeMove=t}get canvas(){return this._canvas}get periodColor(){return this._periodColor}set periodColor(t){this._periodColor=t,this.paint()}get lineColor(){return this._lineColor}set lineColor(t){this._lineColor=t,this.paint()}get startTime(){return this._startTime}set startTime(t){this._startTime=t,this.paint()}get stopTime(){return this._stopTime}set stopTime(t){this._stopTime=t,this.paint()}get currentTime(){return this._currentTime}set currentTime(t){this._currentTime=t,this.paint()}get periodStartTime(){let i;return this._periods.forEach(t=>{(!i||i>t.start)&&(i=t.start)}),i}get periodStopTime(){let i;return this._periods.forEach(t=>{(!i||i<t.stop)&&(i=t.stop)}),i}addPeriod(t,i,e){(t=t<this._startTime?this._startTime:t)<(i=i>this._stopTime?this._stopTime:i)&&(this._periods.push({start:t,stop:i,name:e}),this.paint())}clear(){this._periods=new Array,this.paint()}paint(){this.stopPaint(),this._paintTimer=window.setInterval(()=>{this.stopPaint(),this._begin_t=this._startTime.getTime(),this._end_t=this._stopTime.getTime(),this._scale_left=this._canvas.clientWidth/100,this._scale_top=this._canvas.clientHeight/20,this._scale_width=this._canvas.clientWidth-2*this._scale_left,this._scale_height=this._canvas.clientHeight-this._scale_top,this._scale_rate=this._scale_width/(this._end_t-this._begin_t),this._ctx.clearRect(0,0,this._canvas.clientWidth,this._canvas.clientHeight);let e=this._scale_top+3*this._scale_height/5,s=this._scale_height/4;this._ctx.lineWidth=1,this._ctx.strokeStyle=window.getComputedStyle(this._canvas).color,this._ctx.fillStyle=this._ctx.strokeStyle,this._ctx.beginPath();for(let t=this._begin_t;t<=this._end_t;t+=36e5){var i=this.dateToX(t);this._ctx.moveTo(i,e-2),this._ctx.lineTo(i,e),this._ctx.moveTo(i,e+s),this._ctx.lineTo(i,e+s+2)}this._ctx.stroke(),this._ctx.font=window.getComputedStyle(this._canvas).font;for(let t=this._begin_t;t<=this._end_t;t+=36e5){var h=this.dateToX(t),_=new Date(t).getHours().toString(),r=this._ctx.measureText(_).width;this._ctx.fillText(_,h-r/2,e-4)}var t;this._ctx.fillStyle=this._periodColor,this._periods.forEach(t=>{var i=t.start.getTime(),t=t.stop.getTime(),i=this.dateToX(i),t=this.dateToX(t);this._ctx.fillRect(i,e,t-i,s)}),this._ctx.strokeStyle=this._lineColor,this._ctx.strokeRect(this._scale_left,e,this._scale_width,s),this._currentTime&&(t=this.dateToX(this._currentTime.getTime()),this._ctx.lineWidth=2,this._ctx.beginPath(),this._ctx.moveTo(t,e),this._ctx.lineTo(t,e+s),this._ctx.stroke())},200)}stopPaint(){this._paintTimer&&(window.clearInterval(this._paintTimer),this._paintTimer=0)}processEvent(t,e){let s=this.xToDate(t.offsetX);if(e&&s>=this._startTime&&s<this._stopTime){let i;this._periods.some(t=>{if(t.start<=s&&s<t.stop)return i=t,!0}),e(t,s,i)}}xToDate(t){return new Date(this._begin_t+(t-this._scale_left)/this._scale_rate)}dateToX(t){return(t-this._begin_t)*this._scale_rate+this._scale_left}}